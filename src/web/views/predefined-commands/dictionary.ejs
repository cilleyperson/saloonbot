<%- include('../layout', { body: `
<div class="page">
  ${(function() {
    const escapeHtml = (str) => {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    };
    const displayName = escapeHtml(channel.display_name || channel.twitch_username);

    return `
  <div class="page-header">
    <div class="page-header-content">
      <a href="/channels/${channel.id}/predefined" class="back-link">&larr; Back to Predefined Commands</a>
      <h1 class="page-title">Custom Definitions</h1>
      <p class="page-subtitle">${displayName}</p>
    </div>
  </div>

  <div class="page-content">
    <div class="alert alert-info mb-6">
      Custom definitions override the dictionary API. When someone uses <code>!define word</code>,
      the bot will first check for a custom definition before querying the online dictionary.
    </div>

    <div class="card mb-6">
      <div class="card-header">
        <h3 class="card-title">Add Custom Definition</h3>
      </div>
      <div class="card-body">
        <form action="/channels/${channel.id}/predefined/define/definitions" method="POST">
          <input type="hidden" name="_csrf" value="${csrfToken}">
          <div class="grid grid-cols-2 gap-4">
            <div class="form-group">
              <label for="word" class="form-label">Word</label>
              <input type="text" id="word" name="word" class="form-input" placeholder="Enter word..." required pattern="[a-zA-Z]+" title="Letters only">
            </div>
            <div class="form-group">
              <label for="part_of_speech" class="form-label">Part of Speech (optional)</label>
              <input type="text" id="part_of_speech" name="part_of_speech" class="form-input" placeholder="noun, verb, etc.">
            </div>
          </div>
          <div class="form-group">
            <label for="definition" class="form-label">Definition</label>
            <textarea id="definition" name="definition" rows="3" class="form-input" placeholder="Enter definition..." required></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Add Definition</button>
        </form>
      </div>
    </div>

    ${definitions.length > 0 ? `
    <div class="card">
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Word</th>
              <th>Part of Speech</th>
              <th>Definition</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${definitions.map(def => {
              const word = escapeHtml(def.word);
              const pos = escapeHtml(def.part_of_speech || '-');
              const definition = escapeHtml(def.definition);
              return `
            <tr>
              <td><strong>${word}</strong></td>
              <td>${pos}</td>
              <td class="text-truncate" title="${definition}">${definition}</td>
              <td>
                <form action="/channels/${channel.id}/predefined/define/definitions/${def.id}/delete" method="POST" class="inline-form">
                  <input type="hidden" name="_csrf" value="${csrfToken}">
                  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this definition?')">Delete</button>
                </form>
              </td>
            </tr>
              `;
            }).join('')}
          </tbody>
        </table>
      </div>
    </div>
    ` : `
    <div class="card">
      <div class="card-body">
        <div class="empty-state">
          <h3>No custom definitions</h3>
          <p>Add a custom definition above to override the dictionary API for specific words.</p>
        </div>
      </div>
    </div>
    `}
  </div>
    `;
  })()}
</div>
`, activePage: 'predefined', channel: channel }) %>
