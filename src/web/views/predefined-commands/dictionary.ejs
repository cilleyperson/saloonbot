<%- include('../layout', { body: `
<div class="dictionary-page">
  ${(function() {
    const escapeHtml = (str) => {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    };
    const displayName = escapeHtml(channel.display_name || channel.twitch_username);

    return `
  <div class="page-header">
    <div>
      <a href="/channels/${channel.id}/predefined" class="back-link">&larr; Back to Predefined Commands</a>
      <h1>Custom Definitions</h1>
      <p class="subtitle">${displayName}</p>
    </div>
  </div>

  <p class="info-box">
    Custom definitions override the dictionary API. When someone uses <code>!define word</code>,
    the bot will first check for a custom definition before querying the online dictionary.
  </p>

  <div class="card">
    <h3>Add Custom Definition</h3>
    <form action="/channels/${channel.id}/predefined/define/definitions" method="POST" class="form">
      <input type="hidden" name="_csrf" value="${csrfToken}">
      <div class="form-row">
        <div class="form-group">
          <label for="word">Word</label>
          <input type="text" id="word" name="word" placeholder="Enter word..." required pattern="[a-zA-Z]+" title="Letters only">
        </div>
        <div class="form-group">
          <label for="part_of_speech">Part of Speech (optional)</label>
          <input type="text" id="part_of_speech" name="part_of_speech" placeholder="noun, verb, etc.">
        </div>
      </div>
      <div class="form-group">
        <label for="definition">Definition</label>
        <textarea id="definition" name="definition" rows="3" placeholder="Enter definition..." required></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Add Definition</button>
    </form>
  </div>

  ${definitions.length > 0 ? `
  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>Word</th>
          <th>Part of Speech</th>
          <th>Definition</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${definitions.map(def => {
          const word = escapeHtml(def.word);
          const pos = escapeHtml(def.part_of_speech || '-');
          const definition = escapeHtml(def.definition);
          return `
        <tr>
          <td><strong>${word}</strong></td>
          <td>${pos}</td>
          <td class="truncate" title="${definition}">${definition}</td>
          <td class="actions">
            <form action="/channels/${channel.id}/predefined/define/definitions/${def.id}/delete" method="POST" class="inline-form">
              <input type="hidden" name="_csrf" value="${csrfToken}">
              <button type="submit" class="btn btn-small btn-danger" onclick="return confirm('Delete this definition?')">Delete</button>
            </form>
          </td>
        </tr>
          `;
        }).join('')}
      </tbody>
    </table>
  </div>
  ` : `
  <div class="empty-state">
    <p>No custom definitions yet.</p>
    <p>Add a custom definition above to override the dictionary API for specific words.</p>
  </div>
  `}
    `;
  })()}
</div>

<style>
.info-box {
  background: var(--bg-secondary, #f5f5f5);
  padding: 1rem;
  border-radius: 4px;
  margin-bottom: 1.5rem;
}
.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}
@media (max-width: 600px) {
  .form-row {
    grid-template-columns: 1fr;
  }
}
</style>
` }) %>
