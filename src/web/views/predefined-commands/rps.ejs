<%- include('../layout', { body: `
<div class="rps-page">
  ${(function() {
    const escapeHtml = (str) => {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    };
    const displayName = escapeHtml(channel.display_name || channel.twitch_username);

    return `
  <div class="page-header">
    <div>
      <a href="/channels/${channel.id}/predefined" class="back-link">&larr; Back to Predefined Commands</a>
      <h1>Rock Paper Scissors Leaderboard</h1>
      <p class="subtitle">${displayName}</p>
    </div>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <span class="stat-value">${totalGames}</span>
      <span class="stat-label">Total Games</span>
    </div>
    <div class="stat-card">
      <span class="stat-value">${playerCount}</span>
      <span class="stat-label">Players</span>
    </div>
  </div>

  ${leaderboard.length > 0 ? `
  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>Player</th>
          <th>Wins</th>
          <th>Losses</th>
          <th>Ties</th>
          <th>Win %</th>
          <th>Best Streak</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${leaderboard.map((stats, i) => {
          const username = escapeHtml(stats.username);
          return `
        <tr>
          <td>
            ${i === 0 ? '1st' : i === 1 ? '2nd' : i === 2 ? '3rd' : i + 1}
          </td>
          <td><strong>${username}</strong></td>
          <td class="win">${stats.wins}</td>
          <td class="loss">${stats.losses}</td>
          <td>${stats.ties}</td>
          <td>${stats.win_percentage}%</td>
          <td>${stats.best_streak}</td>
          <td class="actions">
            <form action="/channels/${channel.id}/predefined/rps/stats/${stats.user_id}/reset" method="POST" class="inline-form">
              <input type="hidden" name="_csrf" value="${csrfToken}">
              <button type="submit" class="btn btn-small btn-danger" onclick="return confirm('Reset this user\\'s stats?')">Reset</button>
            </form>
          </td>
        </tr>
          `;
        }).join('')}
      </tbody>
    </table>
  </div>
  ` : `
  <div class="empty-state">
    <p>No games played yet.</p>
    <p>Users can play by typing <code>!rps rock</code>, <code>!rps paper</code>, or <code>!rps scissors</code> in chat.</p>
  </div>
  `}
    `;
  })()}
</div>

<style>
.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
  max-width: 400px;
}
.stat-card {
  padding: 1rem;
  border-radius: 8px;
  text-align: center;
  background: var(--bg-secondary, #f5f5f5);
}
.stat-value {
  display: block;
  font-size: 2rem;
  font-weight: bold;
}
.stat-label {
  font-size: 0.875rem;
  text-transform: uppercase;
  color: var(--text-secondary, #666);
}
.win { color: #28a745; }
.loss { color: #dc3545; }
</style>
` }) %>
