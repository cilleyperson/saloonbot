<%- include('../layout', { body: `
<div class="page">
  ${(function() {
    const escapeHtml = (str) => {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    };
    const displayName = escapeHtml(channel.display_name || channel.twitch_username);

    return `
  <div class="page-header">
    <div class="page-header-content">
      <a href="/channels/${channel.id}/predefined" class="back-link">&larr; Back to Predefined Commands</a>
      <h1 class="page-title">Magic 8 Ball Responses</h1>
      <p class="page-subtitle">${displayName}</p>
    </div>
  </div>

  <div class="page-content">
    <div class="stats-row mb-6">
      <div class="stat-card stat-card-success">
        <span class="stat-value">${counts.positive}</span>
        <span class="stat-label">Positive</span>
      </div>
      <div class="stat-card stat-card-warning">
        <span class="stat-value">${counts.neutral}</span>
        <span class="stat-label">Neutral</span>
      </div>
      <div class="stat-card stat-card-error">
        <span class="stat-value">${counts.negative}</span>
        <span class="stat-label">Negative</span>
      </div>
    </div>

    <div class="card mb-6">
      <div class="card-header">
        <h3 class="card-title">Add New Response</h3>
      </div>
      <div class="card-body">
        <form action="/channels/${channel.id}/predefined/ball/responses" method="POST">
          <input type="hidden" name="_csrf" value="${csrfToken}">
          <div class="grid grid-cols-3 gap-4">
            <div class="form-group" style="grid-column: span 2;">
              <label for="response_text" class="form-label">Response Text</label>
              <input type="text" id="response_text" name="response_text" class="form-input" placeholder="Enter response text..." required>
            </div>
            <div class="form-group">
              <label for="response_type" class="form-label">Type</label>
              <select id="response_type" name="response_type" class="form-input">
                <option value="positive">Positive</option>
                <option value="neutral" selected>Neutral</option>
                <option value="negative">Negative</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Add Response</button>
        </form>
      </div>
    </div>

    <div class="card">
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Response</th>
              <th>Type</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${responses.map(resp => {
              const respText = escapeHtml(resp.response_text);
              const respType = escapeHtml(resp.response_type);
              const badgeClass = respType === 'positive' ? 'badge-success' : respType === 'negative' ? 'badge-error' : 'badge-warning';
              return `
            <tr class="${resp.is_active ? '' : 'row-muted'}">
              <td>${respText}</td>
              <td>
                <span class="badge ${badgeClass}">${respType}</span>
              </td>
              <td>
                <span class="badge ${resp.is_active ? 'badge-success' : 'badge-error'}">
                  ${resp.is_active ? 'active' : 'inactive'}
                </span>
              </td>
              <td>
                <div class="btn-group">
                  <form action="/channels/${channel.id}/predefined/ball/responses/${resp.id}/toggle" method="POST" class="inline-form">
                    <input type="hidden" name="_csrf" value="${csrfToken}">
                    <button type="submit" class="btn btn-sm btn-secondary">${resp.is_active ? 'Disable' : 'Enable'}</button>
                  </form>
                  <form action="/channels/${channel.id}/predefined/ball/responses/${resp.id}/delete" method="POST" class="inline-form">
                    <input type="hidden" name="_csrf" value="${csrfToken}">
                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this response?')">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
              `;
            }).join('')}
          </tbody>
        </table>
      </div>
    </div>
  </div>
    `;
  })()}
</div>
`, activePage: 'predefined', channel: channel }) %>
